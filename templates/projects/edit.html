<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modifier {{ entity_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.js') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>
<!-- Menu de navigation -->
        <nav>
    <ul>
        <li><a href="/">Accueil</a></li>
        <li>Tâches :</li>
        <ul>
            <li><a href="/tasks/list">Liste des tâches</a></li>
            <li><a href="/tasks/create">Créer une tâche</a></li>
        </ul>
        <li>Projets :</li>
        <ul>
            <li><a href="/projects/list">Liste des projets</a></li>
            <li><a href="/projects/create">Créer un projet</a></li>
        </ul>
        <li>Protections :</li>
        <ul>
            <li><a href="/protections/list">Liste des protections</a></li>
            <li><a href="/protections/create">Créer une protection</a></li>
        </ul>
        <li>Matériels :</li>
        <ul>
            <li><a href="/materials/list">Liste des matériels</a></li>
            <li><a href="/materials/create">Créer un matériel</a></li>
        </ul>
        <li>Consommables :</li>
        <ul>
            <li><a href="/consumables/list">Liste des consommables</a></li>
            <li><a href="/consumables/create">Créer un consommable</a></li>
        </ul>
    </ul>
</nav>
    <div class="container">
        <h1>Modifier le projet</h1>
    <form action="{{ url_for('edit_project', id=project.id) }}" method="post">
        <label for="name">Nom:</label>
        <input type="text" id="name" name="name" value="{{ project.name }}" required><br>

        <label for="goal">Objectif:</label>
        <input type="text" id="goal" name="goal" value="{{ project.goal }}"><br>

        <label for="principle">Principe:</label>
        <input type="text" id="principle" name="principle" value="{{ project.principle }}"><br>

        <label for="protocol">Protocole:</label>
        <input type="text" id="protocol" name="protocol" value="{{ project.protocol }}"><br>

        <label for="protections">Protections:</label>
        <input type="text" id="protections" name="protections" value="">
        <br>

        <label for="materials">Matériels:</label>
        <input type="text" id="materials" name="materials" value="">
        <br>

        <label for="consumables">Consommables:</label>
        <input type="text" id="consumables" name="consumables" value="">
        <br>

        <label for="prerequisites">Prérequis:</label>
        <input type="text" id="prerequisites" name="prerequisites" value="">
        <br>

        <label for="time_required">Temps requis:</label>
        <input type="number" id="time_required" name="time_required" value="{{ project.time_required }}"><br>
        <select id="time_required_unit" name="time_required_unit">
            <option value="seconds" {% if project.time_required_unit == 'seconds' %}selected{% endif %}>Secondes</option>
            <option value="minutes" {% if project.time_required_unit == 'minutes' %}selected{% endif %}>Minutes</option>
            <option value="hours" {% if project.time_required_unit == 'hours' %}selected{% endif %}>Heures</option>
            <option value="days" {% if project.time_required_unit == 'days' %}selected{% endif %}>Jours</option>
            <option value="weeks" {% if project.time_required_unit == 'weeks' %}selected{% endif %}>Semaines</option>
            <option value="months" {% if project.time_required_unit == 'months' %}selected{% endif %}>Mois</option>
            <option value="years" {% if project.time_required_unit == 'years' %}selected{% endif %}>Années</option>
        </select><br>

        <label for="funding">Financement:</label>
        <input type="number" step="0.01" id="funding" name="funding" value="{{ project.funding }}"><br>

        <label for="benefits">Bénéfices:</label>
        <input type="number" step="0.01" id="benefits" name="benefits" value="{{ project.benefits }}"><br>

        <label for="time_to_sell">Temps pour vendre:</label>
        <input type="number" id="time_to_sell" name="time_to_sell" value="{{ project.time_to_sell }}"><br>
        <select id="time_to_sell_unit" name="time_to_sell_unit">
            <option value="seconds" {% if project.time_to_sell_unit == 'seconds' %}selected{% endif %}>Secondes</option>
            <option value="minutes" {% if project.time_to_sell_unit == 'minutes' %}selected{% endif %}>Minutes</option>
            <option value="hours" {% if project.time_to_sell_unit == 'hours' %}selected{% endif %}>Heures</option>
            <option value="days" {% if project.time_to_sell_unit == 'days' %}selected{% endif %}>Jours</option>
            <option value="weeks" {% if project.time_to_sell_unit == 'weeks' %}selected{% endif %}>Semaines</option>
            <option value="months" {% if project.time_to_sell_unit == 'months' %}selected{% endif %}>Mois</option>
            <option value="years" {% if project.time_to_sell_unit == 'years' %}selected{% endif %}>Années</option>
        </select><br>
        <label for="due_date">Date d'échéance:</label>
        <input type="date" id="due_date" name="due_date" value="{{ project.due_date }}">
        <label for="planned_date">Date de réalisation:</label>
        <input type="date" id="planned_date" name="planned_date" value="{{ project.planned_date }}">
        <button type="submit">Mettre à jour le projet</button>
        <h3>Tâches existantes</h3>
    <ul>
        {% for task in project.tasks %}
        <li>
            {{ task.name }}
            {% if not task.is_done %}
                <a href="{{ url_for('mark_project_task_done', project_id=project.id, task_id=task.id) }}">Fait ?</a>
            {% else %}
                <a href="{{ url_for('mark_project_task_undone', project_id=project.id, task_id=task.id) }}">Non fait ?</a>
            {% endif %}
            <a href="{{ url_for('edit_task', id=task.id) }}">Modifier</a>
            <form action="{{ url_for('delete_project_task', project_id=project.id, task_id=task.id) }}" method="post" style="display:inline;">
                <button type="submit">Supprimer</button>
            </form>
        </li>
        {% endfor %}
    </ul>
    <h3>Ajouter des tâches</h3>
    <div id="tasks-container">
        <input type="text" name="tasks" placeholder="Nom de la tâche">
    </div>
    <button type="button" onclick="addTaskInput()">Ajouter une autre tâche</button>
    <button type="submit">Mettre à jour le projet</button>
</form>
<script>
    function addTaskInput() {
        const container = document.getElementById('tasks-container');
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'tasks';
        input.placeholder = 'Nom de la tâche';
        container.appendChild(input);
    }
</script>
    <br>
    <a href="{{ url_for('list_projects') }}">Retour à la liste des projets</a>
    <script>
        $(document).ready(function() {
            function setupAutocomplete(selector, url) {
                $(selector).autocomplete({
                    source: function(request, response) {
                        $.ajax({
                            url: url,
                            dataType: "json",
                            data: { query: request.term },
                            success: function(data) {
                                response($.map(data, function(item) {
                                    return {
                                        label: item.name,
                                        value: item.name
                                    };
                                }));
                            }
                        });
                    },
                    minLength: 2,
                    select: function(event, ui) {
                        // Ajouter des traitements spécifiques ici si nécessaire
                    }
                });
            }

            setupAutocomplete("#protections", "/autocomplete/protections");
            setupAutocomplete("#materials", "/autocomplete/materials");
            setupAutocomplete("#consumables", "/autocomplete/consumables");
            setupAutocomplete("#prerequisites", "/autocomplete/prerequisites");
        });
    </script>
</body>
</html>